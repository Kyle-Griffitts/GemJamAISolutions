@page "/heatmap"
@using GemJamAISolutions.Client.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<PageTitle>FloodReady AI - Flood Risk Heatmap</PageTitle>

<div class="heatmap-container min-vh-100 py-4 py-md-5">
    <div class="container-fluid h-100">
        <div class="row h-100">
            <div class="col-12">
                <!-- Header -->
                <div class="d-flex align-items-center mb-3 gap-2">
                    <button class="btn btn-link text-white text-decoration-none p-2 btn-back" @onclick="GoBack">
                        <span class="fs-4">&larr;</span>
                    </button>
                    <h1 class="fs-3 fs-md-2 fw-bold text-white mb-0">Florida Flood Risk Heatmap</h1>
                </div>

                <!-- Map Container -->
                <div class="bg-white rounded-4 shadow-lg p-3 p-md-4" style="height: calc(100vh - 150px); min-height: 500px;">
                    <div class="position-relative h-100">
                        <!-- Loading Indicator -->
                        @if (isMapLoading)
                        {
                            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center bg-white rounded-3" style="z-index: 2000;">
                                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem; color: #2d5f7e !important;">
                                    <span class="visually-hidden">Loading map...</span>
                                </div>
                                <p class="text-muted fw-medium">Loading Florida Flood Risk Map...</p>
                            </div>
                        }

                        <MapView Class="h-100 w-100 rounded-3" Longitude="-81.5158" Latitude="27.6648" Zoom="7" OnViewRendered="OnMapLoaded">
                            <Map>
                                <Basemap>
                                    <BasemapStyle Name="@BasemapStyleName.ArcgisTopographic" />
                                </Basemap>
                            </Map>
                        </MapView>

                        <!-- Map Controls Info -->
                        @if (!isMapLoading)
                        {
                            <div class="position-absolute top-0 end-0 m-3 bg-white rounded-3 shadow p-3" style="max-width: 300px; z-index: 1000;">
                                <h5 class="fs-6 fw-semibold text-dark mb-2">üìç Map Controls</h5>
                                <p class="small text-muted mb-2">Use mouse/touch to pan and zoom</p>
                                <p class="small text-muted mb-0">Centered on Florida</p>
                            </div>
                        }
                    </div>
                </div>

                <!-- Legend (for future use) -->
                <div class="mt-3">
                    <div class="bg-white rounded-4 shadow-lg p-3">
                        <div class="d-flex flex-wrap gap-3 align-items-center justify-content-center">
                            <div class="d-flex align-items-center gap-2">
                                <div style="width: 20px; height: 20px; background: #d7191c; border-radius: 4px;"></div>
                                <span class="small fw-medium text-dark">Extreme Risk</span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <div style="width: 20px; height: 20px; background: #fdae61; border-radius: 4px;"></div>
                                <span class="small fw-medium text-dark">High Risk</span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <div style="width: 20px; height: 20px; background: #ffffbf; border-radius: 4px;"></div>
                                <span class="small fw-medium text-dark">Moderate Risk</span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <div style="width: 20px; height: 20px; background: #a6d96a; border-radius: 4px;"></div>
                                <span class="small fw-medium text-dark">Low Risk</span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <div style="width: 20px; height: 20px; background: #1a9641; border-radius: 4px;"></div>
                                <span class="small fw-medium text-dark">Minimal Risk</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private bool isMapLoading = true;

    private void OnMapLoaded()
    {
        isMapLoading = false;
        StateHasChanged();
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/analysis");
    }
}